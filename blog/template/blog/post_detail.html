{% extends 'base.html' %}
{% block content %}
<div class="card mb-4">
  {% if post.image %}
    <img src="{{ post.image.url }}" class="card-img-top" alt="{{ post.title }}">
  {% endif %}
  <div class="card-body">
    <h2 class="card-title">{{ post.title }}</h2>
    <p class="card-text">{{ post.content }}</p>
    <p class="text-muted">By {{ post.author }} on {{ post.created_at|date:"M d, Y" }}</p>
    {% if user == post.author %}
      <a class="btn btn-sm btn-primary" href="{% url 'post_update' post.slug %}">Edit</a>
      <a class="btn btn-sm btn-danger" href="{% url 'post_delete' post.slug %}">Delete</a>
    {% endif %}
  </div>
</div>

<h4>Comments</h4>
<ul class="list-group mb-4">
{% for comment in comments %}
  <li class="list-group-item d-flex justify-content-between align-items-start">
    <div>
      <b>{{ comment.user }}:</b> {{ comment.text }}
      <small class="text-muted d-block">{{ comment.created_at|date:"M d, Y H:i" }}</small>
    </div>
    {% if user == comment.user %}
      <a class="btn btn-sm btn-outline-danger" href="{% url 'comment_delete' comment.pk %}">Delete</a>
    {% endif %}
  </li>
{% empty %}
  <li class="list-group-item">No comments yet.</li>
{% endfor %}
</ul>

{% if user.is_authenticated %}
<form method="post">
  {% csrf_token %}
  {{ form.text|as_crispy_field }}
  <button class="btn btn-success mt-2" type="submit">Add Comment</button>
</form>
{% else %}
<p><a href="{% url 'login' %}">Login</a> to comment.</p>
{% endif %}
{% endblock %}
