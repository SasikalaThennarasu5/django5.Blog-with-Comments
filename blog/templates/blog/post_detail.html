{% extends 'blog/base.html' %}
{% load crispy_forms_tags %}
{% block title %}{{ post.title }}{% endblock %}
{% block content %}
<article class="mb-4">
  <h1 class="mb-1">{{ post.title }}</h1>
  <p class="text-muted small">By {{ post.author }} â€¢ {{ post.created_at|date:"M d, Y H:i" }}</p>
  {% if post.image %}
    <img src="{{ post.image.url }}" class="img-fluid rounded mb-3 shadow" alt="{{ post.title }}">
  {% endif %}
  <div class="lead">{{ post.content|linebreaks }}</div>

  {% if user == post.author %}
    <div class="mt-3">
      <a href="{% url 'blog:post_edit' slug=post.slug %}" class="btn btn-outline-primary btn-sm">âœï¸ Edit</a>
      <!-- Trigger modal -->
      <button class="btn btn-outline-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteModal">ğŸ—‘ï¸ Delete</button>
    </div>
  {% endif %}
</article>

<!-- Delete Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title">Confirm Delete</h5></div>
      <div class="modal-body">Are you sure you want to delete <strong>{{ post.title }}</strong>?</div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <form method="post" action="{% url 'blog:post_delete' slug=post.slug %}">
          {% csrf_token %}
          <button class="btn btn-danger">Delete</button>
        </form>
      </div>
    </div>
  </div>
</div>

<hr>
<section id="comments">
  <h4 class="mb-3">ğŸ’¬ Comments ({{ post.comments.count }})</h4>
  {% include 'blog/includes/comments_list.html' with comments=post.comments.all %}
  {% if user.is_authenticated %}
    <form action="{% url 'blog:add_comment' slug=post.slug %}" method="post" class="mt-4">
      {% csrf_token %}
      <div class="mb-3">
        <textarea name="text" class="form-control" rows="3" placeholder="Write your comment..."></textarea>
      </div>
      <button class="btn btn-primary">Post Comment</button>
    </form>
  {% else %}
    <p><a href="{% url 'login' %}?next={{ request.path }}">Login</a> to comment.</p>
  {% endif %}
</section>
{% endblock %}
